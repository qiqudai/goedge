# ??????????????

## ?????????? Nginx
- ?????????? Nginx/OpenResty?
  - HTTP ?????host?status?bytes?cache_status?upstream_time ???
  - Stream ?????port?protocol?bytes?session time??
  - ????? Nginx ?? + ???????
- ???????????????ipset/iptables??? Agent ??????

## ?????????

### ?????? `/v1/monitor/site/realtime`
- ?????HTTP access log ????????
- ???bandwidth/traffic/req/qps/???/???/????????

### ?????? `/v1/monitor/site/top`
- ?????HTTP access log ?? TOP?IP/URL/??/Referer/??/????
- ?? `cc=1` ?????????? CC ??/??????????

### ????? `/v1/monitor/site/blackip`
- ??????? ipset/iptables + CC ???????
- ?????? IP???????????

### ???????? `/v1/monitor/site/access-log`
- ?????HTTP access log ?????
- ????????? + ?????

### ???? `/v1/monitor/usage`
- ????????????/?????
- ??? Agent ????????

### ???????? `/v1/monitor/stream/realtime`
- ?????Stream access log ???

### ???????? `/v1/monitor/stream/top`
- ?????Stream access log ?? TOP ???

## ??????????

### ????
- HTTP??? `log_format` ???????host?server_port?cache_status?up_resp_time?up_recv??
- Stream???? `log_format` ?? port/protocol/bytes/addr?

### ????
1) Agent ?? tail/offset ?? access log???????
2) ? 1m/5m ?????QPS????????????????
3) ?? TOP ???IP/URL/Referer/??/????
4) ????????ipset list + ??????
5) ?????????/SQLite?????????

## ??????????

### ????????
- ???? POST ?????????? Redis??
- ?????? HTTPS + Token/HMAC???? mTLS?

?????
- `POST /v1/monitor/push/site-realtime`
- `POST /v1/monitor/push/site-top`
- `POST /v1/monitor/push/site-blackip`
- `POST /v1/monitor/push/site-access-log`
- `POST /v1/monitor/push/usage`
- `POST /v1/monitor/push/stream-realtime`
- `POST /v1/monitor/push/stream-top`
- `POST /v1/monitor/push/batch`?????????

### ????????
- ??????????
  - `GET /v1/node/metrics/realtime`
  - `GET /v1/node/metrics/top`
- ?????? API????????

## ??????
- ??? Redis ??????????
- ?? HTTPS + Token/HMAC ???????timestamp + nonce??
- ?????? + ???????????

## ??????
- ????????????? API ???
  - ???????????????
  - ??????????
- ?????????????????? reload ? Agent ????
